/*
 jQuery Text Highlighter
 Copyright (C) 2011 by mirz

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(d){function u(){d(k).data("textHighlighter",m)}function s(){k=this;m=d(k).data("textHighlighter");var c,b=h(),e=null;b.rangeCount>0&&(e=b.getRangeAt(0));if((c=e)&&!c.collapsed){if(m.onBeforeHighlight(c)==!0){b=d.fn.textHighlighter.createWrapper(m);if(c.collapsed)b=void 0;else{var e=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"],f=c.startContainer,i=c.endContainer,A=c.commonAncestorContainer,n=!0;if(c.endOffset==0){for(;!i.previousSibling&&i.parentNode!=A;)i=i.parentNode;i=i.previousSibling}else i.nodeType==
j.TEXT_NODE?c.endOffset<i.nodeValue.length&&i.splitText(c.endOffset):c.endOffset>0&&(i=i.childNodes.item(c.endOffset-1));f.nodeType==j.TEXT_NODE?c.startOffset==f.nodeValue.length?n=!1:c.startOffset>0&&(f=f.splitText(c.startOffset),i==f.previousSibling&&(i=f)):f=c.startOffset<f.childNodes.length?f.childNodes.item(c.startOffset):f.nextSibling;c=!1;A=[];do{n&&f.nodeType==j.TEXT_NODE&&(/\S/.test(f.nodeValue)&&(n=b.clone(!0).get(0),n=d(f).wrap(n).parent().get(0),A.push(n)),n=!1);if(f==i&&(!i.hasChildNodes()||
!n))c=!0;d.inArray(f.tagName,e)!=-1&&(n=!1);n&&f.hasChildNodes()?f=f.firstChild:f.nextSibling!=null?(f=f.nextSibling,n=!0):(f=f.parentNode,n=!1)}while(!c);b=A}b=q(b);m.onAfterHighlight(b)}h().removeAllRanges()}}function q(c){p(c);r(c);return d.map(c,function(b){return typeof b.parentElement!="undefined"?b.parentElement!=null?b:null:b.parentNode!=null?b:null})}function p(c){d.each(c,function(b){var e=d(this);if(e.parent().hasClass(m.highlightedClass)){var e=e.parent(),f=e.text(),f=document.createTextNode(f);
e.empty();e.append(f);d(c[b]).remove()}})}function r(c){function b(b){return b&&b.nodeType==j.ELEMENT_NODE&&d(b).hasClass(m.highlightedClass)?!0:!1}d.each(c,function(){var e=this.previousSibling,f=this.nextSibling;if(b(e)){var c=d(e).text()+d(this).text();d(this).text(c);d(e).remove()}b(f)&&(c=d(this).text()+d(f).text(),d(this).text(c),d(f).remove())})}function t(c,b){var e="."+m.highlightedClass,e=d(c).find(e);b==!0&&d(c).hasClass(m.highlightedClass)&&(e=e.add(c));return e}function z(c){t(c,!0).each(function(){if(m.onRemoveHighlight(this)==
!0){var b=d(this).contents().unwrap().get(0),e=b.previousSibling,c=b.nextSibling;if(e&&e.nodeType==j.TEXT_NODE)b.nodeValue=e.nodeValue+b.nodeValue,e.parentNode.removeChild(e);c&&c.nodeType==j.TEXT_NODE&&(b.nodeValue+=c.nodeValue,c.parentNode.removeChild(c))}})}function i(){var c=k.ownerDocument?k.ownerDocument:k;return c.defaultView?c.defaultView:c.parentWindow}function h(){var c=i(),b=null;c.getSelection?b=c.getSelection():d("iframe").length>0?d("iframe",top.document).each(function(){if(this.contentWindow===
c)return b=rangy.getIframeSelection(this),!1}):b=rangy.getSelection();return b}var k=null,m={},o={init:function(c){k=this;m=d.extend({},d.fn.textHighlighter.defaults,c);u();d(k).addClass(m.contextClass);d(k).mouseup(s)},destroy:function(){d(k).unbind("mouseup",s);d(k).removeClass(m.contextClass)},setColor:function(c){m.color=c;u()},getColor:function(){return m.color},removeHighlights:function(c){z(c!=void 0?c:k)}},j={ELEMENT_NODE:1,TEXT_NODE:3};d.fn.textHighlighter=function(c){var b=arguments;if(o[c])return o[c].apply(this,
Array.prototype.slice.call(b,1));else if(typeof c==="object"||!c)return o.init.apply(this,b);else d.error("Method "+c+" does not exist on jQuery.textHighlighter")};d.fn.textHighlighter.createWrapper=function(c){return d("<span>").css("backgroundColor",c.color).addClass(c.highlightedClass)};d.fn.textHighlighter.defaults={color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}}})(jQuery);var rangy=function(){function d(b,e){var c=typeof b[e];return c=="function"||!!(c=="object"&&b[e])||c=="unknown"}function u(b,e){return!!(typeof b[e]=="object"&&b[e])}function s(b,e){return typeof b[e]!="undefined"}function q(b){return function(e,c){for(var f=c.length;f--;)if(!b(e,c[f]))return!1;return!0}}function p(b){window.alert("Rangy not supported in your browser. Reason: "+b);c.initialized=!0;c.supported=!1}function r(){if(!c.initialized){var f,n=!1,x=!1;d(document,"createRange")&&(f=document.createRange(),
m(f,i)&&j(f,z)&&(n=!0),f.detach());if((f=u(document,"body")?document.body:document.getElementsByTagName("body")[0])&&d(f,"createTextRange"))f=f.createTextRange(),m(f,k)&&j(f,h)&&(x=!0);!n&&!x&&p("Neither Range nor TextRange are implemented");c.initialized=!0;c.features={implementsDomRange:n,implementsTextRange:x};n=e.concat(b);x=0;for(f=n.length;x<f;++x)try{n[x](c)}catch(o){u(window,"console")&&d(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",o)}}}function t(b){this.name=
b;this.supported=this.initialized=!1}var z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],h=["boundingHeight","boundingLeft",
"boundingTop","boundingWidth","htmlText","text"],k=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint"],m=q(d),o=q(u),j=q(s),c={initialized:!1,supported:!0,util:{isHostMethod:d,isHostObject:u,isHostProperty:s,areHostMethods:m,areHostObjects:o,areHostProperties:j},features:{},modules:{},config:{alertOnWarn:!1}};c.fail=p;c.warn=function(b){b="Rangy warning: "+b;c.config.alertOnWarn?window.alert(b):typeof window.console!=
"undefined"&&typeof window.console.log!="undefined"&&window.console.log(b)};var b=[],e=[];c.init=r;c.addInitListener=function(e){c.initialized?e(c):b.push(e)};var f=[];c.addCreateMissingNativeApiListener=function(b){f.push(b)};c.createMissingNativeApi=function(b){b=b||window;r();for(var e=0,c=f.length;e<c;++e)f[e](b)};t.prototype.fail=function(b){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+b);};t.prototype.warn=function(b){c.warn("Module "+this.name+
": "+b)};t.prototype.createError=function(b){return Error("Error in Rangy "+this.name+" module: "+b)};c.createModule=function(b,f){var d=new t(b);c.modules[b]=d;e.push(function(b){f(b,d);d.initialized=!0;d.supported=!0})};c.requireModules=function(b){for(var e=0,f=b.length,d,i;e<f;++e){i=b[e];d=c.modules[i];if(!d||!(d instanceof t))throw Error("Module '"+i+"' not found");if(!d.supported)throw Error("Module '"+i+"' not supported");}};var x=!1,o=function(){x||(x=!0,c.initialized||r())};if(typeof window==
"undefined")p("No window found");else if(typeof document=="undefined")p("No document found");else return d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",o,!1),d(window,"addEventListener")?window.addEventListener("load",o,!1):d(window,"attachEvent")?window.attachEvent("onload",o):p("Window does not have required addEventListener or attachEvent method"),c}();
rangy.createModule("DomUtil",function(d,u){function s(b){for(var e=0;b=b.previousSibling;)e++;return e}function q(b,e){var f=[],d;for(d=b;d;d=d.parentNode)f.push(d);for(d=e;d;d=d.parentNode)if(c(f,d))return d;return null}function p(b,e,c){for(c=c?b:b.parentNode;c;){b=c.parentNode;if(b===e)return c;c=b}return null}function r(b){b=b.nodeType;return b==3||b==4||b==8}function t(b,e){var c=e.nextSibling,d=e.parentNode;c?d.insertBefore(b,c):d.appendChild(b);return b}function z(b){if(b.nodeType==9)return b;
else if(typeof b.ownerDocument!="undefined")return b.ownerDocument;else if(typeof b.document!="undefined")return b.document;else if(b.parentNode)return z(b.parentNode);else throw Error("getDocument: no document found for node");}function i(b){return!b?"[No node]":r(b)?'"'+b.data+'"':b.nodeType==1?"<"+b.nodeName+(b.id?' id="'+b.id+'"':"")+">["+b.childNodes.length+"]":b.nodeName}function h(b){this._next=this.root=b}function k(b,e){this.node=b;this.offset=e}function m(b){this.code=this[b];this.codeName=
b;this.message="DOMException: "+this.codeName}var o=d.util;o.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||u.fail("document missing a Node creation method");o.isHostMethod(document,"getElementsByTagName")||u.fail("document missing getElementsByTagName method");var j=document.createElement("div");o.areHostMethods(j,["insertBefore","appendChild","cloneNode"])||u.fail("Incomplete Element implementation");j=document.createTextNode("test");o.areHostMethods(j,["splitText",
"deleteData","insertData","appendData","cloneNode"])||u.fail("Incomplete Text Node implementation");var c=function(b,e){for(var c=b.length;c--;)if(b[c]===e)return!0;return!1};h.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var b=this._current=this._next,e;if(this._current){if(!(e=b.firstChild))for(e=null;b!==this.root&&!(e=b.nextSibling);)b=b.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}};k.prototype={equals:function(b){return this.node===
b.node&this.offset==b.offset},inspect:function(){return"[DomPosition("+i(this.node)+":"+this.offset+")]"}};m.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};m.prototype.toString=function(){return this.message};d.dom={arrayContains:c,getNodeIndex:s,getCommonAncestor:q,isAncestorOf:function(b,e,c){for(e=c?e:e.parentNode;e;)if(e===b)return!0;else e=e.parentNode;return!1},getClosestAncestorIn:p,
isCharacterDataNode:r,insertAfter:t,splitDataNode:function(b,e){var c;b.nodeType==3?c=b.splitText(e):(c=b.cloneNode(),c.deleteData(0,e),b.deleteData(0,b.length-e),t(c,b));return c},getDocument:z,getWindow:function(b){b=z(b);if(typeof b.defaultView!="undefined")return b.defaultView;else if(typeof b.parentWindow!="undefined")return b.parentWindow;else throw Error("Cannot get a window object for node");},getIframeWindow:function(b){if(typeof b.contentWindow!="undefined")return b.contentWindow;else if(typeof b.contentDocument!=
"undefined")return b.contentDocument.defaultView;else throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(b){if(typeof b.contentDocument!="undefined")return b.contentDocument;else if(typeof b.contentWindow!="undefined")return b.contentWindow.document;else throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(b){return o.isHostObject(b,"body")?b.body:b.getElementsByTagName("body")[0]},comparePoints:function(b,
e,c,d){var i;if(b==c)return e===d?0:e<d?-1:1;else if(i=p(c,b,!0))return e<=s(i)?-1:1;else if(i=p(b,c,!0))return s(i)<d?-1:1;else if(e=q(b,c),b=b===e?e:p(b,e,!0),c=c===e?e:p(c,e,!0),b===c)throw Error("comparePoints got to case 4 and childA and childB are the same!");else{for(e=e.firstChild;e;){if(e===b)return-1;else if(e===c)return 1;e=e.nextSibling}throw Error("Should not be here!");}},inspectNode:i,createIterator:function(b){return new h(b)},DomPosition:k};d.DOMException=m});
rangy.createModule("DomRange",function(d){function u(a,b){return a.nodeType!=3&&(g.isAncestorOf(a,b.startContainer,!0)||g.isAncestorOf(a,b.endContainer,!0))}function s(a){return g.getDocument(a.startContainer)}function q(a,b,e){if(b=a._listeners[b])for(var c=0,l=b.length;c<l;++c)b[c].call(a,{target:a,args:e})}function p(a){return new F(a.parentNode,g.getNodeIndex(a))}function r(a){return new F(a.parentNode,g.getNodeIndex(a)+1)}function t(a){return g.isCharacterDataNode(a)?a.length:a.childNodes?a.childNodes.length:
0}function z(a,b,c){var e=a.nodeType==11?a.firstChild:a;g.isCharacterDataNode(b)?c==b.length?g.insertAfter(a,b):b.parentNode.insertBefore(a,c==0?b:g.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return e}function i(a){for(var b,c,e=s(a.range).createDocumentFragment();c=a.next();){b=a.isPartiallySelectedSubtree();c=c.cloneNode(!b);b&&(b=a.getSubtreeIterator(),c.appendChild(i(b)),b.detach(!0));if(c.nodeType==10)throw new B("HIERARCHY_REQUEST_ERR");e.appendChild(c)}return e}
function h(a,b,c){for(var e,l,c=c||{stop:!1};e=a.next();)if(a.isPartiallySelectedSubtree())if(b(e)===!1){c.stop=!0;break}else{if(e=a.getSubtreeIterator(),h(e,b,c),e.detach(!0),c.stop)break}else for(e=g.createIterator(e);l=e.next();)if(b(l)===!1){c.stop=!0;return}}function k(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),k(b),b.detach(!0)):a.remove()}function m(a){for(var b,c=s(a.range).createDocumentFragment(),e;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),
e=a.getSubtreeIterator(),b.appendChild(m(e)),e.detach(!0)):a.remove();if(b.nodeType==10)throw new B("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function o(a,b,e){var l=!(!b||!b.length),d,i=!!e;l&&(d=RegExp("^("+b.join("|")+")$"));var f=[];h(new c(a,!1),function(a){(!l||d.test(a.nodeType))&&(!i||e(a))&&f.push(a)});return f}function j(a){return"["+(typeof a.getName=="undefined"?"Range":a.getName())+"("+g.inspectNode(a.startContainer)+":"+a.startOffset+", "+g.inspectNode(a.endContainer)+":"+a.endOffset+
")]"}function c(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&g.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!g.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:g.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!g.isCharacterDataNode(this.ec)?
this.ec.childNodes[this.eo-1]:g.getClosestAncestorIn(this.ec,c,!0))}}function b(a){this.code=this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function e(a,b,c){this.nodes=o(a,b,c);this._next=this.nodes[0];this._position=0}function f(a){return function(b,c){for(var e,l=c?b:b.parentNode;l;){e=l.nodeType;if(g.arrayContains(a,e))return l;l=l.parentNode}return null}}function x(a){for(var b;b=a.parentNode;)a=b;return a}function A(a,c){if(P(a,c))throw new b("INVALID_NODE_TYPE_ERR");
}function n(a){if(!a.startContainer)throw new B("INVALID_STATE_ERR");}function D(a,c){if(!g.arrayContains(c,a.nodeType))throw new b("INVALID_NODE_TYPE_ERR");}function G(a,b){if(b<0||b>(g.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new B("INDEX_SIZE_ERR");}function y(a,b){if(l(a,!0)!==l(b,!0))throw new B("WRONG_DOCUMENT_ERR");}function C(a){if(K(a,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR");}function H(a,b){if(!a)throw new B(b);}function v(a){if(!l(a.startContainer,!0)||!l(a.endContainer,
!0)||!(a.startOffset<=(g.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(g.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function E(a){a.START_TO_START=R;a.START_TO_END=U;a.END_TO_END=Z;a.END_TO_START=V;a.NODE_BEFORE=W;a.NODE_AFTER=X;a.NODE_BEFORE_AND_AFTER=Y;a.NODE_INSIDE=S}function L(a){E(a);
E(a.prototype)}function O(l,d,f){function K(a,b){return function(c){n(this);D(c,I);D(x(c),Q);c=(a?p:r)(c);(b?P:q)(this,c.node,c.offset)}}function P(a,b,c){var e=a.endContainer,l=a.endOffset;if(b!==a.startContainer||c!==this.startOffset){if(x(b)!=x(e)||g.comparePoints(b,c,e,l)==1)e=b,l=c;d(a,b,c,e,l)}}function q(a,b,c){var e=a.startContainer,l=a.startOffset;if(b!==a.endContainer||c!==this.endOffset){if(x(b)!=x(e)||g.comparePoints(b,c,e,l)==-1)e=b,l=c;d(a,e,l,b,c)}}function E(a,b,c){(b!==a.startContainer||
c!==this.startOffset||b!==a.endContainer||c!==this.endOffset)&&d(a,b,c,b,c)}function F(a){return function(){n(this);v(this);var b=this.startContainer,e=this.startOffset,l=this.commonAncestorContainer,f=new c(this,!0);if(b!==l)b=g.getClosestAncestorIn(b,l,!0),e=r(b),b=e.node,e=e.offset;h(f,C);f.reset();l=a(f);f.detach();d(this,b,e,b,e);return l}}l.prototype={attachListener:function(a,b){this._listeners[a].push(b)},setStart:function(a,b){n(this);A(a,!0);G(a,b);P(this,a,b)},setEnd:function(a,b){n(this);
A(a,!0);G(a,b);q(this,a,b)},setStartBefore:K(!0,!0),setStartAfter:K(!1,!0),setEndBefore:K(!0,!1),setEndAfter:K(!1,!1),collapse:function(a){n(this);v(this);a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){n(this);A(a,!0);d(this,a,0,a,t(a))},selectNode:function(a){n(this);A(a,!1);D(a,I);var b=p(a),a=r(a);d(this,b.node,b.offset,a.node,a.offset)},compareBoundaryPoints:function(a,
b){n(this);v(this);y(this.startContainer,b.startContainer);var c=a==V||a==R?"start":"end",e=a==U||a==R?"start":"end";return g.comparePoints(this[c+"Container"],this[c+"Offset"],b[e+"Container"],b[e+"Offset"])},insertNode:function(a){n(this);v(this);D(a,J);C(this.startContainer);if(g.isAncestorOf(a,this.startContainer,!0))throw new B("HIERARCHY_REQUEST_ERR");this.setStartBefore(z(a,this.startContainer,this.startOffset))},cloneContents:function(){n(this);v(this);var a,b;if(this.collapsed)return s(this).createDocumentFragment();
else{if(this.startContainer===this.endContainer&&g.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=s(this).createDocumentFragment(),b.appendChild(a),b;else b=new c(this,!0),a=i(b),b.detach();return a}},extractContents:F(m),deleteContents:F(k),canSurroundContents:function(){n(this);v(this);C(this.startContainer);C(this.endContainer);var a=new c(this,!0),b=a._first&&u(a._first,this)||a._last&&u(a._last,this);
a.detach();return!b},surroundContents:function(c){D(c,a);if(!this.canSurroundContents())throw new b("BAD_BOUNDARYPOINTS_ERR");var e=this.extractContents();if(c.hasChildNodes())for(;c.lastChild;)c.removeChild(c.lastChild);z(c,this.startContainer,this.startOffset);c.appendChild(e);this.selectNode(c)},cloneRange:function(){n(this);v(this);for(var a=new w(s(this)),b=T.length,c;b--;)c=T[b],a[c]=this[c];return a},detach:function(){f(this)},toString:function(){n(this);v(this);var a=this.startContainer;if(a===
this.endContainer&&g.isCharacterDataNode(a))return a.nodeType==3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";else{var b=[],a=new c(this,!0);h(a,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)});a.detach();return b.join("")}},compareNode:function(a){n(this);v(this);var b=a.parentNode,c=g.getNodeIndex(a);if(!b)throw new B("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return a<0?b>0?Y:W:b>0?X:S},comparePoint:function(a,b){n(this);v(this);H(a,"HIERARCHY_REQUEST_ERR");
y(a,this.startContainer);if(g.comparePoints(a,b,this.startContainer,this.startOffset)<0)return-1;else if(g.comparePoints(a,b,this.endContainer,this.endOffset)>0)return 1;return 0},createContextualFragment:function(a){n(this);var b=s(this),c=b.createElement("div");c.innerHTML=a;for(a=b.createDocumentFragment();b=c.firstChild;)a.appendChild(b);return a},intersectsNode:function(a,b){n(this);v(this);H(a,"NOT_FOUND_ERR");if(g.getDocument(a)!==s(this))return!1;var c=a.parentNode,e=g.getNodeIndex(a);H(c,
"NOT_FOUND_ERR");var l=g.comparePoints(c,e,this.endContainer,this.endOffset),c=g.comparePoints(c,e+1,this.startContainer,this.startOffset);return b?l<=0&&c>=0:l<0&&c>0},isPointInRange:function(a,b){n(this);v(this);H(a,"HIERARCHY_REQUEST_ERR");y(a,this.startContainer);return g.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&g.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){n(this);v(this);if(s(a)!=s(this))throw new B("WRONG_DOCUMENT_ERR");return g.comparePoints(this.startContainer,
this.startOffset,a.endContainer,a.endOffset)<0&&g.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset)>0},intersection:function(a){if(this.intersectsRange(a)){var b=g.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=g.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),e=this.cloneRange();b==-1&&e.setStart(a.startContainer,a.startOffset);c==1&&e.setEnd(a.endContainer,a.endOffset);return e}return null},containsNode:function(a,
b){return b?this.intersectsNode(a,!1):this.compareNode(a)==S},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,t(a))<=0},splitBoundaries:function(){v(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,l=a===c;g.isCharacterDataNode(c)&&e>0&&e<c.length&&g.splitDataNode(c,e);g.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=g.splitDataNode(a,b),l?(e-=b,c=a):c==a.parentNode&&e>=g.getNodeIndex(a)&&e++,b=0);d(this,a,b,c,e)},normalizeBoundaries:function(){v(this);
var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,l=function(a){var b=a.nextSibling;if(b&&b.nodeType==a.nodeType)c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b)},f=function(l){var d=l.previousSibling;if(d&&d.nodeType==l.nodeType){a=l;var f=l.length;b=d.length;l.insertData(0,d.data);d.parentNode.removeChild(d);a==c?(e+=b,c=a):c==l.parentNode&&(d=g.getNodeIndex(l),e==d?(c=l,e=f):e>d&&e--)}},i=!0;g.isCharacterDataNode(c)?c.length==e&&l(c):(e>0&&(i=c.childNodes[e-
1])&&g.isCharacterDataNode(i)&&l(i),i=!this.collapsed);i?g.isCharacterDataNode(a)?b==0&&f(a):b<a.childNodes.length&&(l=a.childNodes[b])&&g.isCharacterDataNode(l)&&f(l):(a=c,b=e);d(this,a,b,c,e)},createNodeIterator:function(a,b){n(this);v(this);return new e(this,a,b)},getNodes:function(a,b){n(this);v(this);return o(this,a,b)},collapseToPoint:function(a,b){n(this);v(this);A(a,!0);G(a,b);E(this,a,b)},collapseBefore:function(a){n(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){n(this);
this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return w.rangesEqual(this,a)},inspect:function(){return j(this)}};L(l)}function M(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:g.getCommonAncestor(a.startContainer,a.endContainer)}function N(a,b,c,e,l){var d=a.startContainer!==b||a.startOffset!==c,f=a.endContainer!==e||a.endOffset!==l;a.startContainer=b;a.startOffset=
c;a.endContainer=e;a.endOffset=l;M(a);q(a,"boundarychange",{startMoved:d,endMoved:f})}function w(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};M(this)}d.requireModules(["DomUtil"]);var g=d.dom,F=g.DomPosition,B=d.DOMException;c.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=
this._current=this._next;if(a)this._next=a!==this._last?a.nextSibling:null,g.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so));return a},remove:function(){var a=this._current,b,c;g.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},
isPartiallySelectedSubtree:function(){return u(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new w(s(this.range));var b=this._current,e=b,l=0,d=b,f=t(b);if(g.isAncestorOf(b,this.sc,!0))e=this.sc,l=this.so;if(g.isAncestorOf(b,this.ec,!0))d=this.ec,f=this.eo;N(a,e,l,d,f)}return new c(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=
this._last=this.sc=this.so=this.ec=this.eo=null}};b.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};b.prototype.toString=function(){return this.message};e.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var I=[1,3,4,5,7,8,10],Q=[2,9,11],J=[1,3,4,5,7,8,10,11],a=[1,3,4,5,7,8],l=f([9,11]),K=f([5,6,10,12]),P=f([6,
10,12]),T=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],R=0,U=1,Z=2,V=3,W=0,X=1,Y=2,S=3;O(w,N,function(a){n(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;q(a,"detach",null);a._listeners=null});w.fromRange=function(a){var b=new w(s(a));N(b,a.startContainer,a.startOffset,a.endContainer,a.endOffset);return b};w.rangeProperties=T;w.RangeIterator=c;w.copyComparisonConstants=L;w.createPrototypeRange=
O;w.inspect=j;w.getRangeDocument=s;w.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset};w.getEndOffset=t;d.DomRange=w;d.RangeException=b});
rangy.createModule("WrappedRange",function(d){function u(d,h,k,m){var o=d.duplicate();o.collapse(k);var j=o.parentElement();p.isAncestorOf(h,j,!0)||(j=h);if(!j.canHaveHTML)return new r(j.parentNode,p.getNodeIndex(j));var h=p.getDocument(j).createElement("span"),c,b=k?"StartToStart":"StartToEnd";do j.insertBefore(h,h.previousSibling),o.moveToElementText(h);while((c=o.compareEndPoints(b,d))>0&&h.previousSibling);b=h.nextSibling;if(c==-1&&b&&p.isCharacterDataNode(b)){o.setEndPoint(k?"EndToStart":"EndToEnd",
d);if(/[\r\n]/.test(b.data)){j=o.duplicate();k=j.text.replace(/\r\n/g,"\r").length;for(k=j.moveStart("character",k);j.compareEndPoints("StartToEnd",j)==-1;)k++,j.moveStart("character",1)}else k=o.text.length;j=new r(b,k)}else b=(m||!k)&&h.previousSibling,j=(k=(m||k)&&h.nextSibling)&&p.isCharacterDataNode(k)?new r(k,0):b&&p.isCharacterDataNode(b)?new r(b,b.length):new r(j,p.getNodeIndex(h));h.parentNode.removeChild(h);return j}function s(d,h){var k,m,o=d.offset,j=p.getDocument(d.node),c=j.body.createTextRange(),
b=p.isCharacterDataNode(d.node);b?(k=d.node,m=k.parentNode):(k=d.node.childNodes,k=o<k.length?k[o]:null,m=d.node);j=j.createElement("span");j.innerHTML="&#feff;";k?m.insertBefore(j,k):m.appendChild(j);c.moveToElementText(j);c.collapse(!h);m.removeChild(j);if(b)c[h?"moveStart":"moveEnd"]("character",o);return c}d.requireModules(["DomUtil","DomRange"]);var q,p=d.dom,r=p.DomPosition,t=d.DomRange;if(d.features.implementsDomRange)(function(){function d(b){for(var c=k.length,i;c--;)i=k[c],b[i]=b.nativeRange[i]}
var h,k=t.rangeProperties,m,o;q=function(b){if(!b)throw Error("Range must be specified");this.nativeRange=b;d(this)};t.createPrototypeRange(q,function(b,c,d,i,h){var j=b.endContainer!==i||b.endOffset!=h;if(b.startContainer!==c||b.startOffset!=d||j)b.setEnd(i,h),b.setStart(c,d)},function(b){b.nativeRange.detach();b.detached=!0;for(var c=k.length,d;c--;)d=k[c],b[d]=null});h=q.prototype;h.selectNode=function(b){this.nativeRange.selectNode(b);d(this)};h.deleteContents=function(){this.nativeRange.deleteContents();
d(this)};h.extractContents=function(){var b=this.nativeRange.extractContents();d(this);return b};h.cloneContents=function(){return this.nativeRange.cloneContents()};h.surroundContents=function(b){this.nativeRange.surroundContents(b);d(this)};h.collapse=function(b){this.nativeRange.collapse(b);d(this)};h.cloneRange=function(){return new q(this.nativeRange.cloneRange())};h.refresh=function(){d(this)};h.toString=function(){return this.nativeRange.toString()};var j=document.createTextNode("test");p.getBody(document).appendChild(j);
var c=document.createRange();c.setStart(j,0);c.setEnd(j,0);try{c.setStart(j,1),m=!0,h.setStart=function(b,c){this.nativeRange.setStart(b,c);d(this)},h.setEnd=function(b,c){this.nativeRange.setEnd(b,c);d(this)},o=function(b){return function(c){this.nativeRange[b](c);d(this)}}}catch(b){m=!1,h.setStart=function(b,c){try{this.nativeRange.setStart(b,c)}catch(h){this.nativeRange.setEnd(b,c),this.nativeRange.setStart(b,c)}d(this)},h.setEnd=function(b,c){try{this.nativeRange.setEnd(b,c)}catch(h){this.nativeRange.setStart(b,
c),this.nativeRange.setEnd(b,c)}d(this)},o=function(b,c){return function(h){try{this.nativeRange[b](h)}catch(j){this.nativeRange[c](h),this.nativeRange[b](h)}d(this)}}}h.setStartBefore=o("setStartBefore","setEndBefore");h.setStartAfter=o("setStartAfter","setEndAfter");h.setEndBefore=o("setEndBefore","setStartBefore");h.setEndAfter=o("setEndAfter","setStartAfter");c.selectNodeContents(j);h.selectNodeContents=c.startContainer==j&&c.endContainer==j&&c.startOffset==0&&c.endOffset==j.length?function(b){this.nativeRange.selectNodeContents(b);
d(this)}:function(b){this.setStart(b,0);this.setEnd(b,t.getEndOffset(b))};c.selectNodeContents(j);c.setEnd(j,3);m=document.createRange();m.selectNodeContents(j);m.setEnd(j,4);m.setStart(j,2);h.compareBoundaryPoints=c.compareBoundaryPoints(c.START_TO_END,m)==-1&c.compareBoundaryPoints(c.END_TO_START,m)==1?function(b,c){c=c.nativeRange||c;if(b==c.START_TO_END)b=c.END_TO_START;else if(b==c.END_TO_START)b=c.START_TO_END;return this.nativeRange.compareBoundaryPoints(b,c)}:function(b,c){return this.nativeRange.compareBoundaryPoints(b,
c.nativeRange||c)};p.getBody(document).removeChild(j);c.detach();m.detach()})();else if(d.features.implementsTextRange){q=function(d){this.textRange=d;this.refresh()};q.prototype=new t(document);q.prototype.refresh=function(){var d,h,k=this.textRange;d=k.parentElement();var m=k.duplicate();m.collapse(!0);h=m.parentElement();m=k.duplicate();m.collapse(!1);k=m.parentElement();h=h==k?h:p.getCommonAncestor(h,k);h=h==d?h:p.getCommonAncestor(d,h);this.textRange.compareEndPoints("StartToEnd",this.textRange)==
0?h=d=u(this.textRange,h,!0,!0):(d=u(this.textRange,h,!0,!1),h=u(this.textRange,h,!1,!1));this.setStart(d.node,d.offset);this.setEnd(h.node,h.offset)};q.rangeToTextRange=function(d){if(d.collapsed)return s(new r(d.startContainer,d.startOffset),!0);else{var h=s(new r(d.startContainer,d.startOffset),!0),k=s(new r(d.endContainer,d.endOffset),!1),d=p.getDocument(d.startContainer).body.createTextRange();d.setEndPoint("StartToStart",h);d.setEndPoint("EndToEnd",k);return d}};t.copyComparisonConstants(q);
var z=function(){return this}();if(typeof z.Range=="undefined")z.Range=q}q.prototype.getName=function(){return"WrappedRange"};d.WrappedRange=q;d.createNativeRange=function(i){i=i||document;if(d.features.implementsDomRange)return i.createRange();else if(d.features.implementsTextRange)return i.body.createTextRange()};d.createRange=function(i){return new q(d.createNativeRange(i||document))};d.createRangyRange=function(d){return new t(d||document)};d.createIframeRange=function(i){return d.createRange(p.getIframeDocument(i))};
d.createIframeRangyRange=function(i){return d.createRangyRange(p.getIframeDocument(i))};d.addCreateMissingNativeApiListener(function(i){i=i.document;if(typeof i.createRange=="undefined")i.createRange=function(){return d.createRange(this)};i=i=null})});
rangy.createModule("WrappedSelection",function(d,u){function s(a){return(a||window).getSelection()}function q(a){return(a||window).document.selection}function p(a,b,c){var d=c?"end":"start",c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function r(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function t(a){var c;if(a instanceof f){if(c=a._selectionNativeRange,
!c)c=d.createNativeRange(b.getDocument(a.startContainer)),c.setEnd(a.endContainer,a.endOffset),c.setStart(a.startContainer,a.startOffset),a._selectionNativeRange=c,a.attachListener("detach",function(){this._selectionNativeRange=null})}else a instanceof x?c=a.nativeRange:window.Range&&a instanceof Range&&(c=a);return c}function z(a){var c=a.getNodes(),d;a:if(!c.length||c[0].nodeType!=1)d=!1;else{d=1;for(var e=c.length;d<e;++d)if(!b.isAncestorOf(c[0],c[d])){d=!1;break a}d=!0}if(!d)throw Error("getSingleElementFromRange: range "+
a.inspect()+" did not consist of a single element");return c[0]}function i(a,b){var c=new x(b);a._ranges=[c];p(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function h(a){a._ranges.length=0;if(a.docSelection.type=="None")r(a);else{var c=a.docSelection.createRange();if(c&&typeof c.text!="undefined")i(a,c);else{a.rangeCount=c.length;for(var e,f=b.getDocument(c.item(0)),g=0;g<a.rangeCount;++g)e=d.createRange(f),e.selectNode(c.item(g)),a._ranges.push(e);a.isCollapsed=a.rangeCount==1&&a._ranges[0].collapsed;
p(a,a._ranges[a.rangeCount-1],!1)}}}function k(a,c){for(var d=a.docSelection.createRange(),e=z(c),f=b.getDocument(d.item(0)),f=b.getBody(f).createControlRange(),g=0,i=d.length;g<i;++g)f.add(d.item(g));try{f.add(e)}catch(j){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select();h(a)}function m(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=[];this.win=c;this.refresh()}function o(a,c){for(var d=b.getDocument(c[0].startContainer),
d=b.getBody(d).createControlRange(),e=0,f;e<rangeCount;++e){f=z(c[e]);try{d.add(f)}catch(g){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();h(a)}function j(a,c){if(a.anchorNode&&b.getDocument(a.anchorNode)!==b.getDocument(c))throw new A("WRONG_DOCUMENT_ERR");}function c(a){var b=[],c=new n(a.anchorNode,a.anchorOffset),d=new n(a.focusNode,a.focusOffset),e=typeof a.getName=="function"?a.getName():
"Selection";if(typeof a.rangeCount!="undefined")for(var g=0,h=a.rangeCount;g<h;++g)b[g]=f.inspect(a.getRangeAt(g));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}d.requireModules(["DomUtil","DomRange","WrappedRange"]);d.config.checkSelectionRanges=!0;var b=d.dom,e=d.util,f=d.DomRange,x=d.WrappedRange,A=d.DOMException,n=b.DomPosition,D,G,y=d.util.isHostMethod(window,"getSelection"),C=d.util.isHostObject(document,"selection");y?(D=s,d.isSelectionValid=function(){return!0}):
C?(D=q,d.isSelectionValid=function(a){var a=(a||window).document,c=a.selection;return c.type!="None"||b.getDocument(c.createRange().parentElement())==a}):u.fail("No means of obtaining a selection object");d.getNativeSelection=D;var y=D(),H=d.createNativeRange(document),v=b.getBody(document),E=e.areHostObjects(y,e.areHostProperties(y,["anchorOffset","focusOffset"]));d.features.selectionHasAnchorAndFocus=E;var L=e.isHostMethod(y,"extend");d.features.selectionHasExtend=L;var O=typeof y.rangeCount=="number";
d.features.selectionHasRangeCount=O;var M=!1,N=!0;e.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount=="number"&&d.features.implementsDomRange&&function(){var a=document.createElement("iframe");v.appendChild(a);var c=b.getIframeDocument(a);c.open();c.write("<html><head></head><body>12</body></html>");c.close();var d=b.getIframeWindow(a).getSelection(),e=c.documentElement.lastChild.firstChild,c=c.createRange();c.setStart(e,1);c.collapse(!0);d.addRange(c);N=d.rangeCount==
1;d.removeAllRanges();var f=c.cloneRange();c.setStart(e,0);f.setEnd(e,2);d.addRange(c);d.addRange(f);M=d.rangeCount==2;c.detach();f.detach();v.removeChild(a)}();d.features.selectionSupportsMultipleRanges=M;d.features.collapsedNonEditableSelectionsSupported=N;var w=!1,g;v&&e.isHostMethod(v,"createControlRange")&&(g=v.createControlRange(),e.areHostProperties(g,["item","add"])&&(w=!0));d.features.implementsControlRange=w;G=E?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:
function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var F;e.isHostMethod(y,"getRangeAt")?F=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:E&&(F=function(a){var c=b.getDocument(a.anchorNode),c=d.createRange(c);c.setStart(a.anchorNode,a.anchorOffset);c.setEnd(a.focusNode,a.focusOffset);c.collapsed!==this.isCollapsed&&(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,a.anchorOffset));return c});d.getSelection=function(a){var a=a||window,b=a._rangySelection,
c=D(a),d=C?q(a):null;b?(b.nativeSelection=c,b.docSelection=d,b.refresh(a)):(b=new m(c,d,a),a._rangySelection=b);return b};d.getIframeSelection=function(a){return d.getSelection(b.getIframeWindow(a))};g=m.prototype;if(E&&e.areHostMethods(y,["removeAllRanges","addRange"])){g.removeAllRanges=function(){this.nativeSelection.removeAllRanges();r(this)};var B=function(a,b){var c=f.getRangeDocument(b),c=d.createRange(c);c.collapseToPoint(b.endContainer,b.endOffset);a.nativeSelection.addRange(t(c));a.nativeSelection.extend(b.startContainer,
b.startOffset);a.refresh()};g.addRange=O?function(a,b){if(w&&C&&this.docSelection.type=="Control")k(this,a);else if(b&&L)B(this,a);else{var c;M?c=this.rangeCount:(this.removeAllRanges(),c=0);this.nativeSelection.addRange(t(a));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==c+1){if(d.config.checkSelectionRanges&&(c=F(this.nativeSelection,this.rangeCount-1))&&!f.rangesEqual(c,a))a=new x(c);this._ranges[this.rangeCount-1]=a;p(this,a,J(this.nativeSelection));this.isCollapsed=G(this)}else this.refresh()}}:
function(a,b){b&&L?B(this,a):(this.nativeSelection.addRange(t(a)),this.refresh())};g.setRanges=function(a){if(w&&a.length>1)o(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(e.isHostMethod(y,"empty")&&e.isHostMethod(H,"select")&&w&&C)g.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var a;if(this.anchorNode)a=b.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var c=this.docSelection.createRange();
c.length&&(a=b.getDocument(c.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(d){}r(this)},g.addRange=function(a){this.docSelection.type=="Control"?k(this,a):(x.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,p(this,a,!1))},g.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?o(this,a):b&&this.addRange(a[0])};else return u.fail("No means of selecting a Range or TextRange was found"),
!1;g.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new A("INDEX_SIZE_ERR");else return this._ranges[a]};var I;if(e.isHostMethod(y,"getRangeAt")&&typeof y.rangeCount=="number")I=function(a){if(w&&C&&a.docSelection.type=="Control")h(a);else if(a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount,a.rangeCount){for(var b=0,c=a.rangeCount;b<c;++b)a._ranges[b]=new d.WrappedRange(a.nativeSelection.getRangeAt(b));p(a,a._ranges[a.rangeCount-1],J(a.nativeSelection));a.isCollapsed=G(a)}else r(a)};
else if(E&&typeof y.isCollapsed=="boolean"&&typeof H.collapsed=="boolean"&&d.features.implementsDomRange)I=function(a){var b;b=a.nativeSelection;b.anchorNode?(b=F(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=G(a)):r(a)};else if(e.isHostMethod(y,"createRange")&&C)I=function(a){var c;d.isSelectionValid(a.win)?c=a.docSelection.createRange():(c=b.getBody(a.win.document).createTextRange(),
c.collapse(!0));a.docSelection.type=="Control"?h(a):c&&typeof c.text!="undefined"?i(a,c):r(a)};else return u.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;g.refresh=function(a){var b=a?this._ranges.slice(0):null;I(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!f.rangesEqual(b[a],this._ranges[a]))return!1;return!0}};var Q=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):
d=!0;a.rangeCount||r(a)};g.removeRange=w?function(a){if(this.docSelection.type=="Control"){for(var c=this.docSelection.createRange(),a=z(a),d=b.getDocument(c.item(0)),d=b.getBody(d).createControlRange(),e,f=!1,g=0,i=c.length;g<i;++g)e=c.item(g),e!==a||f?d.add(c.item(g)):f=!0;d.select();h(this)}else Q(this,a)}:function(a){Q(this,a)};var J;E&&d.features.implementsDomRange?(J=function(a){var c=!1;a.anchorNode&&(c=b.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return c},g.isBackwards=
function(){return J(this)}):J=g.isBackwards=function(){return!1};g.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};g.collapse=function(a,c){j(this,a);var e=d.createRange(b.getDocument(a));e.collapseToPoint(a,c);this.removeAllRanges();this.addRange(e);this.isCollapsed=!0};g.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new A("INVALID_STATE_ERR");};g.collapseToEnd=
function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new A("INVALID_STATE_ERR");};g.selectAllChildren=function(a){j(this,a);var c=d.createRange(b.getDocument(a));c.selectNodeContents(a);this.removeAllRanges();this.addRange(c)};g.deleteFromDocument=function(){if(w&&C&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=
this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};g.getAllRanges=function(){return this._ranges.slice(0)};g.setSingleRange=function(a){this.setRanges([a])};g.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};g.getName=function(){return"WrappedSelection"};g.inspect=function(){return c(this)};g.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=
null};m.inspect=c;d.Selection=m;d.addCreateMissingNativeApiListener(function(a){if(typeof a.getSelection=="undefined")a.getSelection=function(){return d.getSelection(this)};a=null})});
