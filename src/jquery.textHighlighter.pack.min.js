(function(d){function u(){var b;b=window.getSelection?window.getSelection():rangy.getSelection();var e=null;b.rangeCount>0&&(e=b.getRangeAt(0));if((b=e)&&!b.collapsed){e=d.fn.textHighlighter.createWrapper(n);if(!b.collapsed){var l=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"],f=b.startContainer,j=b.endContainer,k=b.commonAncestorContainer,i=!0;if(b.endOffset==0){for(;!j.previousSibling&&j.parentNode!=k;)j=j.parentNode;j=j.previousSibling}else j.nodeType==x.TEXT_NODE?b.endOffset<j.nodeValue.length&&
j.splitText(b.endOffset):b.endOffset>0&&(j=j.childNodes.item(b.endOffset-1));f.nodeType==x.TEXT_NODE?b.startOffset==f.nodeValue.length?i=!1:b.startOffset>0&&(f=f.splitText(b.startOffset),j==f.previousSibling&&(j=f)):f=b.startOffset<f.childNodes.length?f.childNodes.item(b.startOffset):f.nextSibling;var k=!1,c=[];do{i&&f.nodeType==x.TEXT_NODE&&(/\S/.test(f.nodeValue)&&(i=e.get(0),d(f).wrap(i),c.push(i)),i=!1);if(f==j&&(!j.hasChildNodes()||!i))k=!0;d.inArray(f.tagName,l)!=-1&&(i=!1);if(i&&f.hasChildNodes())f=
f.firstChild;else if(f.nextSibling!=null)f=f.nextSibling,i=!0;else if(f.nextSibling==null)f=f.parentNode,i=!1}while(!k)}n.normalizeHighlights&&(b=d(b.commonAncestorContainer.nodeType==x.TEXT_NODE?b.commonAncestorContainer.parentNode.parentNode:b.commonAncestorContainer.parentNode).find("."+n.highlightedClass),b.length>1&&(t(b),q(b)));(window.getSelection?window.getSelection():rangy.getSelection()).removeAllRanges()}}function t(b){d.each(b,function(e){var l=d(this);if(l.parent().hasClass(n.highlightedClass)){var l=
l.parent(),f=l.text(),f=document.createTextNode(f);l.empty();l.append(f);b[e]=void 0}})}function q(b){function e(b){return b&&b.nodeType==x.ELEMENT_NODE&&d(b).hasClass(n.highlightedClass)?!0:!1}d.each(b,function(){var b=this.previousSibling,f=this.nextSibling;if(e(b)){var j=d(b).text()+d(this).text();d(this).text(j);d(b).remove()}e(f)&&(j=d(this).text()+d(f).text(),d(this).text(j),d(f).remove())})}var m=null,n={},r={init:function(b){m=this;n=d.extend({},d.fn.textHighlighter.defaults,b);d(m).addClass(n.contextClass);
d(m).mouseup(u)},destroy:function(){d(m).unbind("mouseup",u);d(m).removeClass(n.contextClass)}},x={ELEMENT_NODE:1,TEXT_NODE:3};d.fn.textHighlighter=function(b){var e=arguments;return this.each(function(){if(r[b])return r[b].apply(this,Array.prototype.slice.call(e,1));else if(typeof b==="object"||!b)return r.init.apply(this,e);else d.error("Method "+b+" does not exist on jQuery.textHighlighter")})};d.fn.textHighlighter.createWrapper=function(b){return d("<span>").css("backgroundColor",b.color).addClass(b.highlightedClass)};
d.fn.textHighlighter.defaults={color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",normalizeHighlights:!0,beforeHighlight:function(){},afterHighlight:function(){}}})(jQuery);var rangy=function(){function d(c,b){var o=typeof c[b];return o=="function"||!!(o=="object"&&c[b])||o=="unknown"}function u(c,b){return!!(typeof c[b]=="object"&&c[b])}function t(c,b){return typeof c[b]!="undefined"}function q(c){return function(b,o){for(var d=o.length;d--;)if(!c(b,o[d]))return!1;return!0}}function m(c){window.alert("Rangy not supported in your browser. Reason: "+c);i.initialized=!0;i.supported=!1}function n(){if(!i.initialized){var p,j=!1,y=!1;d(document,"createRange")&&(p=document.createRange(),
f(p,b)&&k(p,x)&&(j=!0),p.detach());if((p=u(document,"body")?document.body:document.getElementsByTagName("body")[0])&&d(p,"createTextRange"))p=p.createTextRange(),f(p,l)&&k(p,e)&&(y=!0);!j&&!y&&m("Neither Range nor TextRange are implemented");i.initialized=!0;i.features={implementsDomRange:j,implementsTextRange:y};j=o.concat(c);y=0;for(p=j.length;y<p;++y)try{j[y](i)}catch(n){u(window,"console")&&d(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",n)}}}function r(c){this.name=
c;this.supported=this.initialized=!1}var x=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],b=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],e=["boundingHeight","boundingLeft",
"boundingTop","boundingWidth","htmlText","text"],l=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint"],f=q(d),j=q(u),k=q(t),i={initialized:!1,supported:!0,util:{isHostMethod:d,isHostObject:u,isHostProperty:t,areHostMethods:f,areHostObjects:j,areHostProperties:k},features:{},modules:{},config:{alertOnWarn:!1}};i.fail=m;i.warn=function(c){c="Rangy warning: "+c;i.config.alertOnWarn?window.alert(c):typeof window.console!=
"undefined"&&typeof window.console.log!="undefined"&&window.console.log(c)};var c=[],o=[];i.init=n;i.addInitListener=function(b){i.initialized?b(i):c.push(b)};var p=[];i.addCreateMissingNativeApiListener=function(c){p.push(c)};i.createMissingNativeApi=function(c){c=c||window;n();for(var b=0,o=p.length;b<o;++b)p[b](c)};r.prototype.fail=function(c){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+c);};r.prototype.warn=function(c){i.warn("Module "+this.name+
": "+c)};r.prototype.createError=function(c){return Error("Error in Rangy "+this.name+" module: "+c)};i.createModule=function(c,b){var d=new r(c);i.modules[c]=d;o.push(function(c){b(c,d);d.initialized=!0;d.supported=!0})};i.requireModules=function(c){for(var b=0,o=c.length,d,p;b<o;++b){p=c[b];d=i.modules[p];if(!d||!(d instanceof r))throw Error("Module '"+p+"' not found");if(!d.supported)throw Error("Module '"+p+"' not supported");}};var y=!1,j=function(){y||(y=!0,i.initialized||n())};if(typeof window==
"undefined")m("No window found");else if(typeof document=="undefined")m("No document found");else return d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",j,!1),d(window,"addEventListener")?window.addEventListener("load",j,!1):d(window,"attachEvent")?window.attachEvent("onload",j):m("Window does not have required addEventListener or attachEvent method"),i}();
rangy.createModule("DomUtil",function(d,u){function t(c){for(var b=0;c=c.previousSibling;)b++;return b}function q(c,b){var d=[],e;for(e=c;e;e=e.parentNode)d.push(e);for(e=b;e;e=e.parentNode)if(i(d,e))return e;return null}function m(c,b,d){for(d=d?c:c.parentNode;d;){c=d.parentNode;if(c===b)return d;d=c}return null}function n(c){c=c.nodeType;return c==3||c==4||c==8}function r(c,b){var d=b.nextSibling,e=b.parentNode;d?e.insertBefore(c,d):e.appendChild(c);return c}function x(c){if(c.nodeType==9)return c;
else if(typeof c.ownerDocument!="undefined")return c.ownerDocument;else if(typeof c.document!="undefined")return c.document;else if(c.parentNode)return x(c.parentNode);else throw Error("getDocument: no document found for node");}function b(c){return!c?"[No node]":n(c)?'"'+c.data+'"':c.nodeType==1?"<"+c.nodeName+(c.id?' id="'+c.id+'"':"")+">["+c.childNodes.length+"]":c.nodeName}function e(c){this._next=this.root=c}function l(c,b){this.node=c;this.offset=b}function f(c){this.code=this[c];this.codeName=
c;this.message="DOMException: "+this.codeName}var j=d.util;j.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||u.fail("document missing a Node creation method");j.isHostMethod(document,"getElementsByTagName")||u.fail("document missing getElementsByTagName method");var k=document.createElement("div");j.areHostMethods(k,["insertBefore","appendChild","cloneNode"])||u.fail("Incomplete Element implementation");k=document.createTextNode("test");j.areHostMethods(k,["splitText",
"deleteData","insertData","appendData","cloneNode"])||u.fail("Incomplete Text Node implementation");var i=function(c,b){for(var d=c.length;d--;)if(c[d]===b)return!0;return!1};e.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var c=this._current=this._next,b;if(this._current){if(!(b=c.firstChild))for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}};l.prototype={equals:function(c){return this.node===
c.node&this.offset==c.offset},inspect:function(){return"[DomPosition("+b(this.node)+":"+this.offset+")]"}};f.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};f.prototype.toString=function(){return this.message};d.dom={arrayContains:i,getNodeIndex:t,getCommonAncestor:q,isAncestorOf:function(c,b,d){for(b=d?b:b.parentNode;b;)if(b===c)return!0;else b=b.parentNode;return!1},getClosestAncestorIn:m,
isCharacterDataNode:n,insertAfter:r,splitDataNode:function(c,b){var d;c.nodeType==3?d=c.splitText(b):(d=c.cloneNode(),d.deleteData(0,b),c.deleteData(0,c.length-b),r(d,c));return d},getDocument:x,getWindow:function(c){c=x(c);if(typeof c.defaultView!="undefined")return c.defaultView;else if(typeof c.parentWindow!="undefined")return c.parentWindow;else throw Error("Cannot get a window object for node");},getIframeWindow:function(c){if(typeof c.contentWindow!="undefined")return c.contentWindow;else if(typeof c.contentDocument!=
"undefined")return c.contentDocument.defaultView;else throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(c){if(typeof c.contentDocument!="undefined")return c.contentDocument;else if(typeof c.contentWindow!="undefined")return c.contentWindow.document;else throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(c){return j.isHostObject(c,"body")?c.body:c.getElementsByTagName("body")[0]},comparePoints:function(c,
b,d,e){var f;if(c==d)return b===e?0:b<e?-1:1;else if(f=m(d,c,!0))return b<=t(f)?-1:1;else if(f=m(c,d,!0))return t(f)<e?-1:1;else if(b=q(c,d),c=c===b?b:m(c,b,!0),d=d===b?b:m(d,b,!0),c===d)throw Error("comparePoints got to case 4 and childA and childB are the same!");else{for(b=b.firstChild;b;){if(b===c)return-1;else if(b===d)return 1;b=b.nextSibling}throw Error("Should not be here!");}},inspectNode:b,createIterator:function(b){return new e(b)},DomPosition:l};d.DOMException=f});
rangy.createModule("DomRange",function(d){function u(a,b){return a.nodeType!=3&&(h.isAncestorOf(a,b.startContainer,!0)||h.isAncestorOf(a,b.endContainer,!0))}function t(a){return h.getDocument(a.startContainer)}function q(a,b,c){if(b=a._listeners[b])for(var g=0,d=b.length;g<d;++g)b[g].call(a,{target:a,args:c})}function m(a){return new G(a.parentNode,h.getNodeIndex(a))}function n(a){return new G(a.parentNode,h.getNodeIndex(a)+1)}function r(a){return h.isCharacterDataNode(a)?a.length:a.childNodes?a.childNodes.length:
0}function x(a,b,c){var g=a.nodeType==11?a.firstChild:a;h.isCharacterDataNode(b)?c==b.length?h.insertAfter(a,b):b.parentNode.insertBefore(a,c==0?b:h.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return g}function b(a){for(var c,g,d=t(a.range).createDocumentFragment();g=a.next();){c=a.isPartiallySelectedSubtree();g=g.cloneNode(!c);c&&(c=a.getSubtreeIterator(),g.appendChild(b(c)),c.detach(!0));if(g.nodeType==10)throw new B("HIERARCHY_REQUEST_ERR");d.appendChild(g)}return d}
function e(a,b,c){for(var g,d,c=c||{stop:!1};g=a.next();)if(a.isPartiallySelectedSubtree())if(b(g)===!1){c.stop=!0;break}else{if(g=a.getSubtreeIterator(),e(g,b,c),g.detach(!0),c.stop)break}else for(g=h.createIterator(g);d=g.next();)if(b(d)===!1){c.stop=!0;return}}function l(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),l(b),b.detach(!0)):a.remove()}function f(a){for(var b,c=t(a.range).createDocumentFragment(),g;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),
g=a.getSubtreeIterator(),b.appendChild(f(g)),g.detach(!0)):a.remove();if(b.nodeType==10)throw new B("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function j(a,b,c){var g=!(!b||!b.length),d,A=!!c;g&&(d=RegExp("^("+b.join("|")+")$"));var o=[];e(new i(a,!1),function(a){(!g||d.test(a.nodeType))&&(!A||c(a))&&o.push(a)});return o}function k(a){return"["+(typeof a.getName=="undefined"?"Range":a.getName())+"("+h.inspectNode(a.startContainer)+":"+a.startOffset+", "+h.inspectNode(a.endContainer)+":"+a.endOffset+
")]"}function i(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!h.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:h.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!h.isCharacterDataNode(this.ec)?
this.ec.childNodes[this.eo-1]:h.getClosestAncestorIn(this.ec,c,!0))}}function c(a){this.code=this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function o(a,b,c){this.nodes=j(a,b,c);this._next=this.nodes[0];this._position=0}function p(a){return function(b,c){for(var g,d=c?b:b.parentNode;d;){g=d.nodeType;if(h.arrayContains(a,g))return d;d=d.parentNode}return null}}function y(a){for(var b;b=a.parentNode;)a=b;return a}function F(a,b){if(P(a,b))throw new c("INVALID_NODE_TYPE_ERR");
}function s(a){if(!a.startContainer)throw new B("INVALID_STATE_ERR");}function D(a,b){if(!h.arrayContains(b,a.nodeType))throw new c("INVALID_NODE_TYPE_ERR");}function H(a,b){if(b<0||b>(h.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new B("INDEX_SIZE_ERR");}function z(a,b){if(g(a,!0)!==g(b,!0))throw new B("WRONG_DOCUMENT_ERR");}function C(a){if(A(a,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR");}function I(a,b){if(!a)throw new B(b);}function v(a){if(!g(a.startContainer,!0)||!g(a.endContainer,
!0)||!(a.startOffset<=(h.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(h.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function E(a){a.START_TO_START=R;a.START_TO_END=U;a.END_TO_END=Z;a.END_TO_START=V;a.NODE_BEFORE=W;a.NODE_AFTER=X;a.NODE_BEFORE_AND_AFTER=Y;a.NODE_INSIDE=S}function L(a){E(a);
E(a.prototype)}function O(g,d,A){function p(a,b){return function(c){s(this);D(c,J);D(y(c),Q);c=(a?m:n)(c);(b?P:q)(this,c.node,c.offset)}}function P(a,b,c){var g=a.endContainer,e=a.endOffset;if(b!==a.startContainer||c!==this.startOffset){if(y(b)!=y(g)||h.comparePoints(b,c,g,e)==1)g=b,e=c;d(a,b,c,g,e)}}function q(a,b,c){var g=a.startContainer,e=a.startOffset;if(b!==a.endContainer||c!==this.endOffset){if(y(b)!=y(g)||h.comparePoints(b,c,g,e)==-1)g=b,e=c;d(a,g,e,b,c)}}function E(a,b,c){(b!==a.startContainer||
c!==this.startOffset||b!==a.endContainer||c!==this.endOffset)&&d(a,b,c,b,c)}function G(a){return function(){s(this);v(this);var b=this.startContainer,c=this.startOffset,g=this.commonAncestorContainer,A=new i(this,!0);if(b!==g)b=h.getClosestAncestorIn(b,g,!0),c=n(b),b=c.node,c=c.offset;e(A,C);A.reset();g=a(A);A.detach();d(this,b,c,b,c);return g}}g.prototype={attachListener:function(a,b){this._listeners[a].push(b)},setStart:function(a,b){s(this);F(a,!0);H(a,b);P(this,a,b)},setEnd:function(a,b){s(this);
F(a,!0);H(a,b);q(this,a,b)},setStartBefore:p(!0,!0),setStartAfter:p(!1,!0),setEndBefore:p(!0,!1),setEndAfter:p(!1,!1),collapse:function(a){s(this);v(this);a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){s(this);F(a,!0);d(this,a,0,a,r(a))},selectNode:function(a){s(this);F(a,!1);D(a,J);var b=m(a),a=n(a);d(this,b.node,b.offset,a.node,a.offset)},compareBoundaryPoints:function(a,
b){s(this);v(this);z(this.startContainer,b.startContainer);var c=a==V||a==R?"start":"end",g=a==U||a==R?"start":"end";return h.comparePoints(this[c+"Container"],this[c+"Offset"],b[g+"Container"],b[g+"Offset"])},insertNode:function(a){s(this);v(this);D(a,K);C(this.startContainer);if(h.isAncestorOf(a,this.startContainer,!0))throw new B("HIERARCHY_REQUEST_ERR");this.setStartBefore(x(a,this.startContainer,this.startOffset))},cloneContents:function(){s(this);v(this);var a,c;if(this.collapsed)return t(this).createDocumentFragment();
else{if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),c=t(this).createDocumentFragment(),c.appendChild(a),c;else c=new i(this,!0),a=b(c),c.detach();return a}},extractContents:G(f),deleteContents:G(l),canSurroundContents:function(){s(this);v(this);C(this.startContainer);C(this.endContainer);var a=new i(this,!0),b=a._first&&u(a._first,this)||a._last&&u(a._last,this);
a.detach();return!b},surroundContents:function(b){D(b,a);if(!this.canSurroundContents())throw new c("BAD_BOUNDARYPOINTS_ERR");var g=this.extractContents();if(b.hasChildNodes())for(;b.lastChild;)b.removeChild(b.lastChild);x(b,this.startContainer,this.startOffset);b.appendChild(g);this.selectNode(b)},cloneRange:function(){s(this);v(this);for(var a=new w(t(this)),b=T.length,c;b--;)c=T[b],a[c]=this[c];return a},detach:function(){A(this)},toString:function(){s(this);v(this);var a=this.startContainer;if(a===
this.endContainer&&h.isCharacterDataNode(a))return a.nodeType==3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";else{var b=[],a=new i(this,!0);e(a,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)});a.detach();return b.join("")}},compareNode:function(a){s(this);v(this);var b=a.parentNode,c=h.getNodeIndex(a);if(!b)throw new B("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return a<0?b>0?Y:W:b>0?X:S},comparePoint:function(a,b){s(this);v(this);I(a,"HIERARCHY_REQUEST_ERR");
z(a,this.startContainer);if(h.comparePoints(a,b,this.startContainer,this.startOffset)<0)return-1;else if(h.comparePoints(a,b,this.endContainer,this.endOffset)>0)return 1;return 0},createContextualFragment:function(a){s(this);var b=t(this),c=b.createElement("div");c.innerHTML=a;for(a=b.createDocumentFragment();b=c.firstChild;)a.appendChild(b);return a},intersectsNode:function(a,b){s(this);v(this);I(a,"NOT_FOUND_ERR");if(h.getDocument(a)!==t(this))return!1;var c=a.parentNode,g=h.getNodeIndex(a);I(c,
"NOT_FOUND_ERR");var d=h.comparePoints(c,g,this.endContainer,this.endOffset),c=h.comparePoints(c,g+1,this.startContainer,this.startOffset);return b?d<=0&&c>=0:d<0&&c>0},isPointInRange:function(a,b){s(this);v(this);I(a,"HIERARCHY_REQUEST_ERR");z(a,this.startContainer);return h.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&h.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){s(this);v(this);if(t(a)!=t(this))throw new B("WRONG_DOCUMENT_ERR");return h.comparePoints(this.startContainer,
this.startOffset,a.endContainer,a.endOffset)<0&&h.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset)>0},intersection:function(a){if(this.intersectsRange(a)){var b=h.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=h.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),g=this.cloneRange();b==-1&&g.setStart(a.startContainer,a.startOffset);c==1&&g.setEnd(a.endContainer,a.endOffset);return g}return null},containsNode:function(a,
b){return b?this.intersectsNode(a,!1):this.compareNode(a)==S},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,r(a))<=0},splitBoundaries:function(){v(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,g=this.endOffset,e=a===c;h.isCharacterDataNode(c)&&g>0&&g<c.length&&h.splitDataNode(c,g);h.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=h.splitDataNode(a,b),e?(g-=b,c=a):c==a.parentNode&&g>=h.getNodeIndex(a)&&g++,b=0);d(this,a,b,c,g)},normalizeBoundaries:function(){v(this);
var a=this.startContainer,b=this.startOffset,c=this.endContainer,g=this.endOffset,e=function(a){var b=a.nextSibling;if(b&&b.nodeType==a.nodeType)c=a,g=a.length,a.appendData(b.data),b.parentNode.removeChild(b)},A=function(d){var e=d.previousSibling;if(e&&e.nodeType==d.nodeType){a=d;var A=d.length;b=e.length;d.insertData(0,e.data);e.parentNode.removeChild(e);a==c?(g+=b,c=a):c==d.parentNode&&(e=h.getNodeIndex(d),g==e?(c=d,g=A):g>e&&g--)}},o=!0;h.isCharacterDataNode(c)?c.length==g&&e(c):(g>0&&(o=c.childNodes[g-
1])&&h.isCharacterDataNode(o)&&e(o),o=!this.collapsed);o?h.isCharacterDataNode(a)?b==0&&A(a):b<a.childNodes.length&&(e=a.childNodes[b])&&h.isCharacterDataNode(e)&&A(e):(a=c,b=g);d(this,a,b,c,g)},createNodeIterator:function(a,b){s(this);v(this);return new o(this,a,b)},getNodes:function(a,b){s(this);v(this);return j(this,a,b)},collapseToPoint:function(a,b){s(this);v(this);F(a,!0);H(a,b);E(this,a,b)},collapseBefore:function(a){s(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){s(this);
this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return w.rangesEqual(this,a)},inspect:function(){return k(this)}};L(g)}function M(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:h.getCommonAncestor(a.startContainer,a.endContainer)}function N(a,b,c,g,d){var e=a.startContainer!==b||a.startOffset!==c,A=a.endContainer!==g||a.endOffset!==d;a.startContainer=b;a.startOffset=
c;a.endContainer=g;a.endOffset=d;M(a);q(a,"boundarychange",{startMoved:e,endMoved:A})}function w(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};M(this)}d.requireModules(["DomUtil"]);var h=d.dom,G=h.DomPosition,B=d.DOMException;i.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=
this._current=this._next;if(a)this._next=a!==this._last?a.nextSibling:null,h.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so));return a},remove:function(){var a=this._current,b,c;h.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},
isPartiallySelectedSubtree:function(){return u(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new w(t(this.range));var b=this._current,c=b,g=0,d=b,e=r(b);if(h.isAncestorOf(b,this.sc,!0))c=this.sc,g=this.so;if(h.isAncestorOf(b,this.ec,!0))d=this.ec,e=this.eo;N(a,c,g,d,e)}return new i(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=
this._last=this.sc=this.so=this.ec=this.eo=null}};c.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};c.prototype.toString=function(){return this.message};o.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var J=[1,3,4,5,7,8,10],Q=[2,9,11],K=[1,3,4,5,7,8,10,11],a=[1,3,4,5,7,8],g=p([9,11]),A=p([5,6,10,12]),P=p([6,
10,12]),T=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],R=0,U=1,Z=2,V=3,W=0,X=1,Y=2,S=3;O(w,N,function(a){s(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;q(a,"detach",null);a._listeners=null});w.fromRange=function(a){var b=new w(t(a));N(b,a.startContainer,a.startOffset,a.endContainer,a.endOffset);return b};w.rangeProperties=T;w.RangeIterator=i;w.copyComparisonConstants=L;w.createPrototypeRange=
O;w.inspect=k;w.getRangeDocument=t;w.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset};w.getEndOffset=r;d.DomRange=w;d.RangeException=c});
rangy.createModule("WrappedRange",function(d){function u(b,d,l,f){var j=b.duplicate();j.collapse(l);var k=j.parentElement();m.isAncestorOf(d,k,!0)||(k=d);if(!k.canHaveHTML)return new n(k.parentNode,m.getNodeIndex(k));var d=m.getDocument(k).createElement("span"),i,c=l?"StartToStart":"StartToEnd";do k.insertBefore(d,d.previousSibling),j.moveToElementText(d);while((i=j.compareEndPoints(c,b))>0&&d.previousSibling);c=d.nextSibling;if(i==-1&&c&&m.isCharacterDataNode(c)){j.setEndPoint(l?"EndToStart":"EndToEnd",
b);if(/[\r\n]/.test(c.data)){k=j.duplicate();l=k.text.replace(/\r\n/g,"\r").length;for(l=k.moveStart("character",l);k.compareEndPoints("StartToEnd",k)==-1;)l++,k.moveStart("character",1)}else l=j.text.length;k=new n(c,l)}else c=(f||!l)&&d.previousSibling,k=(l=(f||l)&&d.nextSibling)&&m.isCharacterDataNode(l)?new n(l,0):c&&m.isCharacterDataNode(c)?new n(c,c.length):new n(k,m.getNodeIndex(d));d.parentNode.removeChild(d);return k}function t(b,d){var l,f,j=b.offset,k=m.getDocument(b.node),i=k.body.createTextRange(),
c=m.isCharacterDataNode(b.node);c?(l=b.node,f=l.parentNode):(l=b.node.childNodes,l=j<l.length?l[j]:null,f=b.node);k=k.createElement("span");k.innerHTML="&#feff;";l?f.insertBefore(k,l):f.appendChild(k);i.moveToElementText(k);i.collapse(!d);f.removeChild(k);if(c)i[d?"moveStart":"moveEnd"]("character",j);return i}d.requireModules(["DomUtil","DomRange"]);var q,m=d.dom,n=m.DomPosition,r=d.DomRange;if(d.features.implementsDomRange)(function(){function b(b){for(var c=l.length,d;c--;)d=l[c],b[d]=b.nativeRange[d]}
var d,l=r.rangeProperties,f,j;q=function(c){if(!c)throw Error("Range must be specified");this.nativeRange=c;b(this)};r.createPrototypeRange(q,function(b,c,d,e,f){var i=b.endContainer!==e||b.endOffset!=f;if(b.startContainer!==c||b.startOffset!=d||i)b.setEnd(e,f),b.setStart(c,d)},function(b){b.nativeRange.detach();b.detached=!0;for(var c=l.length,d;c--;)d=l[c],b[d]=null});d=q.prototype;d.selectNode=function(c){this.nativeRange.selectNode(c);b(this)};d.deleteContents=function(){this.nativeRange.deleteContents();
b(this)};d.extractContents=function(){var c=this.nativeRange.extractContents();b(this);return c};d.cloneContents=function(){return this.nativeRange.cloneContents()};d.surroundContents=function(c){this.nativeRange.surroundContents(c);b(this)};d.collapse=function(c){this.nativeRange.collapse(c);b(this)};d.cloneRange=function(){return new q(this.nativeRange.cloneRange())};d.refresh=function(){b(this)};d.toString=function(){return this.nativeRange.toString()};var k=document.createTextNode("test");m.getBody(document).appendChild(k);
var i=document.createRange();i.setStart(k,0);i.setEnd(k,0);try{i.setStart(k,1),f=!0,d.setStart=function(c,d){this.nativeRange.setStart(c,d);b(this)},d.setEnd=function(c,d){this.nativeRange.setEnd(c,d);b(this)},j=function(c){return function(d){this.nativeRange[c](d);b(this)}}}catch(c){f=!1,d.setStart=function(c,d){try{this.nativeRange.setStart(c,d)}catch(e){this.nativeRange.setEnd(c,d),this.nativeRange.setStart(c,d)}b(this)},d.setEnd=function(c,d){try{this.nativeRange.setEnd(c,d)}catch(e){this.nativeRange.setStart(c,
d),this.nativeRange.setEnd(c,d)}b(this)},j=function(c,d){return function(e){try{this.nativeRange[c](e)}catch(f){this.nativeRange[d](e),this.nativeRange[c](e)}b(this)}}}d.setStartBefore=j("setStartBefore","setEndBefore");d.setStartAfter=j("setStartAfter","setEndAfter");d.setEndBefore=j("setEndBefore","setStartBefore");d.setEndAfter=j("setEndAfter","setStartAfter");i.selectNodeContents(k);d.selectNodeContents=i.startContainer==k&&i.endContainer==k&&i.startOffset==0&&i.endOffset==k.length?function(c){this.nativeRange.selectNodeContents(c);
b(this)}:function(b){this.setStart(b,0);this.setEnd(b,r.getEndOffset(b))};i.selectNodeContents(k);i.setEnd(k,3);f=document.createRange();f.selectNodeContents(k);f.setEnd(k,4);f.setStart(k,2);d.compareBoundaryPoints=i.compareBoundaryPoints(i.START_TO_END,f)==-1&i.compareBoundaryPoints(i.END_TO_START,f)==1?function(b,c){c=c.nativeRange||c;if(b==c.START_TO_END)b=c.END_TO_START;else if(b==c.END_TO_START)b=c.START_TO_END;return this.nativeRange.compareBoundaryPoints(b,c)}:function(b,c){return this.nativeRange.compareBoundaryPoints(b,
c.nativeRange||c)};m.getBody(document).removeChild(k);i.detach();f.detach()})();else if(d.features.implementsTextRange){q=function(b){this.textRange=b;this.refresh()};q.prototype=new r(document);q.prototype.refresh=function(){var b,d,l=this.textRange;b=l.parentElement();var f=l.duplicate();f.collapse(!0);d=f.parentElement();f=l.duplicate();f.collapse(!1);l=f.parentElement();d=d==l?d:m.getCommonAncestor(d,l);d=d==b?d:m.getCommonAncestor(b,d);this.textRange.compareEndPoints("StartToEnd",this.textRange)==
0?d=b=u(this.textRange,d,!0,!0):(b=u(this.textRange,d,!0,!1),d=u(this.textRange,d,!1,!1));this.setStart(b.node,b.offset);this.setEnd(d.node,d.offset)};q.rangeToTextRange=function(b){if(b.collapsed)return t(new n(b.startContainer,b.startOffset),!0);else{var d=t(new n(b.startContainer,b.startOffset),!0),l=t(new n(b.endContainer,b.endOffset),!1),b=m.getDocument(b.startContainer).body.createTextRange();b.setEndPoint("StartToStart",d);b.setEndPoint("EndToEnd",l);return b}};r.copyComparisonConstants(q);
var x=function(){return this}();if(typeof x.Range=="undefined")x.Range=q}q.prototype.getName=function(){return"WrappedRange"};d.WrappedRange=q;d.createNativeRange=function(b){b=b||document;if(d.features.implementsDomRange)return b.createRange();else if(d.features.implementsTextRange)return b.body.createTextRange()};d.createRange=function(b){return new q(d.createNativeRange(b||document))};d.createRangyRange=function(b){return new r(b||document)};d.createIframeRange=function(b){return d.createRange(m.getIframeDocument(b))};
d.createIframeRangyRange=function(b){return d.createRangyRange(m.getIframeDocument(b))};d.addCreateMissingNativeApiListener(function(b){b=b.document;if(typeof b.createRange=="undefined")b.createRange=function(){return d.createRange(this)};b=b=null})});
rangy.createModule("WrappedSelection",function(d,u){function t(a){return(a||window).getSelection()}function q(a){return(a||window).document.selection}function m(a,b,c){var d=c?"end":"start",c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function n(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function r(a){var b;if(a instanceof p){if(b=a._selectionNativeRange,
!b)b=d.createNativeRange(c.getDocument(a.startContainer)),b.setEnd(a.endContainer,a.endOffset),b.setStart(a.startContainer,a.startOffset),a._selectionNativeRange=b,a.attachListener("detach",function(){this._selectionNativeRange=null})}else a instanceof y?b=a.nativeRange:window.Range&&a instanceof Range&&(b=a);return b}function x(a){var b=a.getNodes(),d;a:if(!b.length||b[0].nodeType!=1)d=!1;else{d=1;for(var e=b.length;d<e;++d)if(!c.isAncestorOf(b[0],b[d])){d=!1;break a}d=!0}if(!d)throw Error("getSingleElementFromRange: range "+
a.inspect()+" did not consist of a single element");return b[0]}function b(a,b){var c=new y(b);a._ranges=[c];m(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function e(a){a._ranges.length=0;if(a.docSelection.type=="None")n(a);else{var g=a.docSelection.createRange();if(g&&typeof g.text!="undefined")b(a,g);else{a.rangeCount=g.length;for(var e,h=c.getDocument(g.item(0)),f=0;f<a.rangeCount;++f)e=d.createRange(h),e.selectNode(g.item(f)),a._ranges.push(e);a.isCollapsed=a.rangeCount==1&&a._ranges[0].collapsed;
m(a,a._ranges[a.rangeCount-1],!1)}}}function l(a,b){for(var d=a.docSelection.createRange(),h=x(b),f=c.getDocument(d.item(0)),f=c.getBody(f).createControlRange(),i=0,j=d.length;i<j;++i)f.add(d.item(i));try{f.add(h)}catch(k){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select();e(a)}function f(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=[];this.win=c;this.refresh()}function j(a,b){for(var d=c.getDocument(b[0].startContainer),
d=c.getBody(d).createControlRange(),f=0,h;f<rangeCount;++f){h=x(b[f]);try{d.add(h)}catch(i){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();e(a)}function k(a,b){if(a.anchorNode&&c.getDocument(a.anchorNode)!==c.getDocument(b))throw new F("WRONG_DOCUMENT_ERR");}function i(a){var b=[],c=new s(a.anchorNode,a.anchorOffset),d=new s(a.focusNode,a.focusOffset),f=typeof a.getName=="function"?a.getName():
"Selection";if(typeof a.rangeCount!="undefined")for(var e=0,h=a.rangeCount;e<h;++e)b[e]=p.inspect(a.getRangeAt(e));return"["+f+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}d.requireModules(["DomUtil","DomRange","WrappedRange"]);d.config.checkSelectionRanges=!0;var c=d.dom,o=d.util,p=d.DomRange,y=d.WrappedRange,F=d.DOMException,s=c.DomPosition,D,H,z=d.util.isHostMethod(window,"getSelection"),C=d.util.isHostObject(document,"selection");z?(D=t,d.isSelectionValid=function(){return!0}):
C?(D=q,d.isSelectionValid=function(a){var a=(a||window).document,b=a.selection;return b.type!="None"||c.getDocument(b.createRange().parentElement())==a}):u.fail("No means of obtaining a selection object");d.getNativeSelection=D;var z=D(),I=d.createNativeRange(document),v=c.getBody(document),E=o.areHostObjects(z,o.areHostProperties(z,["anchorOffset","focusOffset"]));d.features.selectionHasAnchorAndFocus=E;var L=o.isHostMethod(z,"extend");d.features.selectionHasExtend=L;var O=typeof z.rangeCount=="number";
d.features.selectionHasRangeCount=O;var M=!1,N=!0;o.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&typeof z.rangeCount=="number"&&d.features.implementsDomRange&&function(){var a=document.createElement("iframe");v.appendChild(a);var b=c.getIframeDocument(a);b.open();b.write("<html><head></head><body>12</body></html>");b.close();var d=c.getIframeWindow(a).getSelection(),e=b.documentElement.lastChild.firstChild,b=b.createRange();b.setStart(e,1);b.collapse(!0);d.addRange(b);N=d.rangeCount==
1;d.removeAllRanges();var f=b.cloneRange();b.setStart(e,0);f.setEnd(e,2);d.addRange(b);d.addRange(f);M=d.rangeCount==2;b.detach();f.detach();v.removeChild(a)}();d.features.selectionSupportsMultipleRanges=M;d.features.collapsedNonEditableSelectionsSupported=N;var w=!1,h;v&&o.isHostMethod(v,"createControlRange")&&(h=v.createControlRange(),o.areHostProperties(h,["item","add"])&&(w=!0));d.features.implementsControlRange=w;H=E?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:
function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var G;o.isHostMethod(z,"getRangeAt")?G=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:E&&(G=function(a){var b=c.getDocument(a.anchorNode),b=d.createRange(b);b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset);b.collapsed!==this.isCollapsed&&(b.setStart(a.focusNode,a.focusOffset),b.setEnd(a.anchorNode,a.anchorOffset));return b});d.getSelection=function(a){var a=a||window,b=a._rangySelection,
c=D(a),d=C?q(a):null;b?(b.nativeSelection=c,b.docSelection=d,b.refresh(a)):(b=new f(c,d,a),a._rangySelection=b);return b};d.getIframeSelection=function(a){return d.getSelection(c.getIframeWindow(a))};h=f.prototype;if(E&&o.areHostMethods(z,["removeAllRanges","addRange"])){h.removeAllRanges=function(){this.nativeSelection.removeAllRanges();n(this)};var B=function(a,b){var c=p.getRangeDocument(b),c=d.createRange(c);c.collapseToPoint(b.endContainer,b.endOffset);a.nativeSelection.addRange(r(c));a.nativeSelection.extend(b.startContainer,
b.startOffset);a.refresh()};h.addRange=O?function(a,b){if(w&&C&&this.docSelection.type=="Control")l(this,a);else if(b&&L)B(this,a);else{var c;M?c=this.rangeCount:(this.removeAllRanges(),c=0);this.nativeSelection.addRange(r(a));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==c+1){if(d.config.checkSelectionRanges&&(c=G(this.nativeSelection,this.rangeCount-1))&&!p.rangesEqual(c,a))a=new y(c);this._ranges[this.rangeCount-1]=a;m(this,a,K(this.nativeSelection));this.isCollapsed=H(this)}else this.refresh()}}:
function(a,b){b&&L?B(this,a):(this.nativeSelection.addRange(r(a)),this.refresh())};h.setRanges=function(a){if(w&&a.length>1)j(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(o.isHostMethod(z,"empty")&&o.isHostMethod(I,"select")&&w&&C)h.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var a;if(this.anchorNode)a=c.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();
b.length&&(a=c.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(d){}n(this)},h.addRange=function(a){this.docSelection.type=="Control"?l(this,a):(y.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,m(this,a,!1))},h.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?j(this,a):b&&this.addRange(a[0])};else return u.fail("No means of selecting a Range or TextRange was found"),
!1;h.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new F("INDEX_SIZE_ERR");else return this._ranges[a]};var J;if(o.isHostMethod(z,"getRangeAt")&&typeof z.rangeCount=="number")J=function(a){if(w&&C&&a.docSelection.type=="Control")e(a);else if(a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount,a.rangeCount){for(var b=0,c=a.rangeCount;b<c;++b)a._ranges[b]=new d.WrappedRange(a.nativeSelection.getRangeAt(b));m(a,a._ranges[a.rangeCount-1],K(a.nativeSelection));a.isCollapsed=H(a)}else n(a)};
else if(E&&typeof z.isCollapsed=="boolean"&&typeof I.collapsed=="boolean"&&d.features.implementsDomRange)J=function(a){var b;b=a.nativeSelection;b.anchorNode?(b=G(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=H(a)):n(a)};else if(o.isHostMethod(z,"createRange")&&C)J=function(a){var g;d.isSelectionValid(a.win)?g=a.docSelection.createRange():(g=c.getBody(a.win.document).createTextRange(),
g.collapse(!0));a.docSelection.type=="Control"?e(a):g&&typeof g.text!="undefined"?b(a,g):n(a)};else return u.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;h.refresh=function(a){var b=a?this._ranges.slice(0):null;J(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!p.rangesEqual(b[a],this._ranges[a]))return!1;return!0}};var Q=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):
d=!0;a.rangeCount||n(a)};h.removeRange=w?function(a){if(this.docSelection.type=="Control"){for(var b=this.docSelection.createRange(),a=x(a),d=c.getDocument(b.item(0)),d=c.getBody(d).createControlRange(),f,h=!1,i=0,j=b.length;i<j;++i)f=b.item(i),f!==a||h?d.add(b.item(i)):h=!0;d.select();e(this)}else Q(this,a)}:function(a){Q(this,a)};var K;E&&d.features.implementsDomRange?(K=function(a){var b=!1;a.anchorNode&&(b=c.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return b},h.isBackwards=
function(){return K(this)}):K=h.isBackwards=function(){return!1};h.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};h.collapse=function(a,b){k(this,a);var e=d.createRange(c.getDocument(a));e.collapseToPoint(a,b);this.removeAllRanges();this.addRange(e);this.isCollapsed=!0};h.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new F("INVALID_STATE_ERR");};h.collapseToEnd=
function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new F("INVALID_STATE_ERR");};h.selectAllChildren=function(a){k(this,a);var b=d.createRange(c.getDocument(a));b.selectNodeContents(a);this.removeAllRanges();this.addRange(b)};h.deleteFromDocument=function(){if(w&&C&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=
this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};h.getAllRanges=function(){return this._ranges.slice(0)};h.setSingleRange=function(a){this.setRanges([a])};h.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};h.getName=function(){return"WrappedSelection"};h.inspect=function(){return i(this)};h.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=
null};f.inspect=i;d.Selection=f;d.addCreateMissingNativeApiListener(function(a){if(typeof a.getSelection=="undefined")a.getSelection=function(){return d.getSelection(this)};a=null})});
